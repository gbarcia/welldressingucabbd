<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="producto">

  <typeAlias alias="producto" type="com.wd.dominio.Producto"/>

  <resultMap id="resultMapProducto" class="producto">
    <result property="id" column="id" />
    <result property="nombre" column="nombre" />
    <result property="descripcion" column="descripcion" />
  </resultMap>

  <resultMap id="resultMapProductoProveedor" class="producto">
    <result property="id" column="id" />
    <result property="nombre" column="nombre" />
    <result property="descripcion" column="descripcion" />
    <result property="precio" column="costo" />
    <result property="fecha_creacion" column="fecha_cre" />
    <result property="fecha_ultima_modificacion" column="fecha_ult_mod" />
  </resultMap>

  <resultMap id="resultMapProductoDepartamento" class="producto">
    <result property="id" column="PRODUCTO_id" />
    <result property="departamentoId" column="DEPARTAMENTO_codigo" />
  </resultMap>

  <insert id="agregarProducto" parameterClass="producto">
    INSERT INTO producto (id, nombre, descripcion)
    VALUES (null, #nombre#, #descripcion#)
  </insert>

  <select id="consultarProducto" parameterClass="int" resultClass="producto">
    SELECT id, nombre, descripcion
    FROM producto
    WHERE id = #id#
  </select>

  <update id="modificarProducto" parameterClass="producto">
    UPDATE producto
    SET nombre = #nombre#, descripcion = #descripcion#
    WHERE id = #id#
  </update>

  <delete id="eliminarProducto" parameterClass="producto">
      DELETE FROM producto
      WHERE id = #id#
  </delete>

  <select id="consultarProductos" resultMap="resultMapProducto">
    SELECT id, nombre, descripcion
    FROM producto
  </select>

  <select id="consultarProductosProveedor" parameterClass="String" resultMap="resultMapProductoProveedor">
    SELECT  produ.id,
    produ.nombre,
    produ.descripcion,
    presu.costo,
    presu.fecha_cre,
    presu.fecha_ult_mod
    FROM PRODUCTO produ, PRESUPUESTO presu, EMPRESA_SERVICIO es
    WHERE produ.id = presu.PRODUCTO_id AND es.rif = presu.EMPRESA_SERVICIO_rif
    AND presu.EMPRESA_SERVICIO_rif = #value#
  </select>

  <insert id="agregarProductoDepartamento" parameterClass="producto">
    INSERT INTO producto_departamento (PRODUCTO_id, DEPARTAMENTO_codigo)
    VALUES (#id#, #departamentoId#)
  </insert>
  
  <delete id="eliminarProductoDepartamento" parameterClass="producto">
    DELETE FROM producto_departamento
    WHERE PRODUCTO_id = #id#
    AND DEPARTAMENTO_codigo = #departamentoId#
  </delete>

  <select id="consultarProductoDepartamento" resultMap="resultMapProductoDepartamento">
    SELECT PRODUCTO_id, DEPARTAMENTO_codigo
    FROM producto_departamento;
  </select>

</sqlMap>